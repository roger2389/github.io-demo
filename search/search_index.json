{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#slippage-models","title":"\u6ed1\u50f9\u6a21\u578b\uff08Slippage Models\uff09","text":"<ul> <li> <p>\u4ea4\u6613\u6210\u672c\uff08transaction costs\uff09\u88ab\u5ee3\u6cdb\u8a8d\u70ba\u662f\u5f71\u97ff\u6295\u8cc7\u7e3e\u6548\u7684\u91cd\u8981\u56e0\u7d20\u3002\u5b83\u5011\u4e0d\u50c5\u5f71\u97ff\u6295\u8cc7\u7e3e\u6548\uff0c\u9084\u5f71\u97ff\u4e86\u5c07\u8cc7\u7522\u8f49\u63db\u6210\u73fe\u91d1\u7684\u96e3\u6613\u5ea6\u3002</p> </li> <li> <p>\u5728\u771f\u5be6\u4e16\u754c\u7684\u4ea4\u6613\u4e2d\u5b58\u5728\u8a31\u591a\u7a2e\u985e\u7684\u4ea4\u6613\u6210\u672c\uff0c\u5176\u4e2d\u4e00\u7a2e\u662f\u9593\u63a5\u6210\u672c\uff08indirect cost\uff09\uff0c\u9593\u63a5\u6210\u672c\u5305\u542b\u4e86\u6ed1\u50f9\uff08slippage\uff09\u3001\u6d41\u52d5\u6027\uff08liquidity\uff09\u7b49\u3002\u56e0\u70ba\u80a1\u50f9\u96a8\u6642\u90fd\u5728\u8b8a\u52d5\uff0c\u4e0b\u55ae\u6642\u7684\u4e9b\u5fae\u6642\u9593\u5dee\u4e5f\u53ef\u80fd\u9020\u6210\u9810\u671f\u7684\u50f9\u683c\u8207\u6210\u4ea4\u50f9\u6709\u843d\u5dee\uff0c\u800c\u9019\u500b\u50f9\u5dee\u5c31\u662f\u6ed1\u50f9\u3002\u6d41\u52d5\u6027\u5247\u6703\u5f71\u97ff\u4ea4\u6613\u7684\u96e3\u6613\u5ea6\uff0c\u6211\u5011\u901a\u5e38\u53ef\u4ee5\u7528\u4ea4\u6613\u91cf\u4f86\u9593\u63a5\u8a55\u4f30\u6d41\u52d5\u6027\u3002\u82e5\u80a1\u7968\u5e73\u5747\u4f86\u8aaa\u4ea4\u6613\u91cf\u9ad8\uff0c\u5247\u901a\u5e38\u4ee3\u8868\u8a72\u80a1\u7968\u6d41\u52d5\u6027\u9ad8\u3001\u53ef\u4ee5\u8fc5\u901f\u9032\u884c\u4ea4\u6613\uff0c\u540c\u6642\u6ed1\u50f9\u7684\u5f71\u97ff\u4e5f\u6703\u964d\u4f4e\u3002</p> </li> <li> <p>\u82e5\u6c92\u6709\u8003\u616e\u6ed1\u50f9\u53ca\u6d41\u52d5\u6027\u53ef\u80fd\u6703\u9ad8\u4f30\u6295\u8cc7\u7b56\u7565\u7684\u7372\u5229\uff0c\u7279\u5225\u662f\u5728\u6295\u8cc7\u7d44\u5408\u4e2d\u6709\u6210\u4ea4\u91cf\u8f03\u4f4e\uff08\u6d41\u52d5\u6027\u5dee\uff09\u7684\u80a1\u7968\u3001\u8cc7\u91d1\u91cf\uff08capital base\uff09\u5927\u6216\u904e\u5ea6\u96c6\u4e2d\u4ea4\u6613\u55ae\u4e00\u500b\u80a1\u6642\uff0c\u5f71\u97ff\u6703\u66f4\u70ba\u660e\u986f\u3002\u9019\u4e5f\u662f\u56de\u6e2c\uff08backtesting\uff09\u7684\u4e00\u5927\u76ee\u7684\uff0c\u8003\u91cf\u6295\u8cc7\u7b56\u7565\u5728\u771f\u5be6\u4e16\u754c\u904b\u884c\u7684\u53ef\u80fd\u6027\u3002</p> </li> </ul>"},{"location":"#ziplineapiset_slippageself-equitiesnone-futuresnone","title":"zipline.api.set_slippage(self, equities=None, futures=None)","text":"<p>\u8a2d\u5b9a\u56de\u6e2c\u6642\u6240\u4f7f\u7528\u7684\u6ed1\u50f9\u6a21\u578b\u3002</p>"},{"location":"#parameters","title":"Parameters\uff1a","text":"<ul> <li>equities (EquitySlippageModel, optional) \uff0d\u7528\u65bc\u4ea4\u6613\u80a1\u7968\u7684\u6ed1\u50f9\u6a21\u578b\u3002</li> <li>EquitySlippageModel\uff1a<code>zipline.finance.slippage</code></li> <li>futures (FutureSlippageModel, optional) \uff0d\u7528\u65bc\u4ea4\u6613\u671f\u8ca8\u7684\u6ed1\u50f9\u6a21\u578b\u3002\uff08\u76ee\u524d\u4e0d\u652f\u63f4\uff09</li> <li>FutureSlippageModel\uff1a<code>zipline.finance.slippage</code></li> </ul>"},{"location":"#raises","title":"Raises\uff1a","text":"<p>SetSlippagePostInit\uff0d<code>set_slippage</code> \u53ea\u80fd\u5728 <code>initialize</code> \u968e\u6bb5\u4f7f\u7528\u3002</p>"},{"location":"#notes","title":"Notes\uff1a","text":"<ul> <li><code>set_slippage</code> \u53ea\u80fd\u4e00\u6b21\u7528\u4e00\u7a2e\u65b9\u6cd5\u3002</li> </ul>"},{"location":"#see-also","title":"See also\uff1a","text":"<ul> <li><code>zipline.finance.slippage.FixedSlippage</code></li> <li><code>zipline.finance.slippage.VolumeShareSlippage</code></li> <li><code>zipline.finance.slippage.FixedBasisPointsSlippage</code></li> </ul>"},{"location":"#examples","title":"Examples\uff1a","text":"<pre><code>from zipline.api import set_slippage\nfrom zipline.finance import slippage\n\ndef initialize(context):\n    set_slippage(slippage.&lt;\u5176\u4e2d\u4e00\u7a2e slippage models&gt;)\n</code></pre>"},{"location":"#class-ziplinefinanceslippageslippagemodel","title":"class zipline.finance.slippage.SlippageModel","text":"<p>\u6ed1\u50f9\u6a21\u578b\u7684\u62bd\u8c61\u57fa\u985e\uff08Abstract Base Class\uff09\u3002</p> <p>\u6ed1\u50f9\u6a21\u578b\u53ef\u7528\u4f86\u4f30\u8a08\u4ea4\u6613\u6210\u4ea4\u50f9\u8207\u8a2d\u5b9a\u4ea4\u6613\u91cf\u9650\u5236\u3002Zipline \u76ee\u524d\u6709\u56db\u7a2e\u6a21\u578b\uff1a 1. <code>FixedSlippage</code>\uff1a\u8a2d\u5b9a\u56fa\u5b9a spread \u7684\u6ed1\u50f9\uff0c\u4e0d\u80fd\u8a2d\u5b9a\u6210\u4ea4\u91cf\u9650\u5236\u3002 2. <code>VolumeShareSlippage</code>\uff1a\u6839\u64da\u8a72\u7b46\u4ea4\u6613\u4f54\u7e3d\u4ea4\u6613\u91cf\u767e\u5206\u6bd4\u4f86\u8a08\u7b97\u6ed1\u50f9\uff0c\u4e26\u53ef\u8a2d\u5b9a\u6210\u4ea4\u91cf\u9650\u5236\u3002 3. <code>FixedBasisPointsSlippage</code>\uff1a\u8a2d\u5b9a\u56fa\u5b9a\u57fa\u9ede\u7684\u6ed1\u50f9\uff0c\u4e26\u53ef\u8a2d\u5b9a\u6210\u4ea4\u91cf\u9650\u5236\u3002 4. <code>NoSlippage</code>\uff1a\u4e0d\u8a2d\u7f6e\u6ed1\u50f9\u3002</p>"},{"location":"#class-ziplinefinanceslippagefixedslippagespread00","title":"class zipline.finance.slippage.FixedSlippage(spread=0.0)","text":"<ul> <li>\u8a2d\u5b9a\u56fa\u5b9a spread \u7684\u6ed1\u50f9\uff0c\u4e0d\u80fd\u8a2d\u5b9a\u6210\u4ea4\u91cf\u9650\u5236\u3002</li> <li>\u5728\u6bcf\u7b46\u4ea4\u6613\u7684\u6210\u4ea4\u50f9\u683c\u984d\u5916\u52a0\u5165 \\(\\pm \\frac{spread}{2}\\)\u3002</li> <li>\u5982\u679c\u662f\u8cb7\u5165\uff0c\u5247\u6210\u4ea4\u50f9\u683c =  $ price + \\frac{spread}{2}$ \uff1b\u82e5\u662f\u8ce3\u51fa\uff0c\u5247\u6210\u4ea4\u50f9\u683c =   $ price - \\frac{spread}{2}\\(\u3002\\) price = \u7576\u65e5\u6536\u76e4\u50f9$\u3002</li> </ul>"},{"location":"#parameters_1","title":"Parameters:","text":"<ul> <li>spread (float, optional) - \u7528\u4f86\u4f30\u8a08\u6210\u4ea4\u50f9\u8207\u7576\u65e5\u6536\u76e4\u50f9\u7684\u50f9\u5dee\u3002</li> </ul>"},{"location":"#class-ziplinefinanceslippagevolumeshareslippagevolume_limit0025-price_impact01","title":"class zipline.finance.slippage.VolumeShareSlippage(volume_limit=0.025, price_impact=0.1)","text":"<p>\u5229\u7528\u8a72\u7b46\u4ea4\u6613\u4f54\u7576\u5929\u7e3d\u4ea4\u6613\u91cf\u7684\u767e\u5206\u6bd4\uff08volume share\uff09\u4f86\u8a08\u7b97\u6ed1\u50f9\uff0c\u8003\u616e\u6ed1\u50f9\u5f8c\u7684\u6210\u4ea4\u50f9\u8a08\u7b97\u65b9\u6cd5\u5982\u4e0b\uff08\u8cb7\u5165\u7684\u8a71\uff0c\u7b26\u865f\u70ba<code>+</code>\uff1b\u8ce3\u51fa\u7684\u8a71\uff0c\u7b26\u865f\u70ba<code>-</code>\uff09:</p> \\[ price \\times [1 \\pm ({price\\_impact}) \\times ({volume\\_share}^2)], \\] <p>$ price = $ \u7576\u65e5\u6536\u76e4\u50f9, $ volume_share = $ \u6b64\u55ae\u4ea4\u6613\u91cf\u4f54\u7e3d\u4ea4\u6613\u91cf\u767e\u5206\u6bd4\u6578\uff0c\u6700\u9ad8\u70ba $ volume_limit $\u3002</p> <p>\u8a2d\u5b9a\u7576\u65e5\u4ea4\u6613\u91cf\u9650\u5236\uff1a $$ historical_volume \\times volume_limit, $$ $ historical_volume = $ \u7576\u65e5\u6210\u4ea4\u91cf\u3002</p>"},{"location":"#parameters_2","title":"Parameters:","text":"<ul> <li>volume_limit (float, optional) - </li> <li>\u9650\u5236\u8cb7\u8ce3\u91cf\u4f54\u7e3d\u4ea4\u6613\u91cf\u7684\u6700\u5927\u767e\u5206\u6bd4\uff0c\u9810\u8a2d = 2.5 %\u3002</li> <li>\u6b64\u9650\u5236\u8003\u616e\u5982\u679c\u8cb7\u8ce3\u5927\u91cf\u80a1\u7968\uff0c\u6703\u5c0d\u80a1\u50f9\u9020\u6210\u904e\u5927\u5f71\u97ff\uff0c\u5c0e\u81f4\u504f\u96e2\u6b77\u53f2\u7684\u50f9\u683c\uff0c\u82e5\u5229\u7528\u7576\u5929\u6536\u76e4\u50f9\u9032\u884c\u6a21\u64ec\u4ea4\u6613\u5c31\u6703\u9ad8\u4f30\u7372\u5229\u3002</li> <li>price_impact (float, optional) - \u6ed1\u50f9\u5f71\u97ff\u7a0b\u5ea6\uff0c\u5176\u503c\u8d8a\u5927\u6642\uff0c\u6ed1\u50f9\u5f71\u97ff\u7a0b\u5ea6\u8d8a\u5927\uff0c\u9810\u8a2d = 0.1\u3002</li> </ul>"},{"location":"#class-ziplinefinanceslippagefixedbasispointsslippagebasis_points50-volume_limit01","title":"class zipline.finance.slippage.FixedBasisPointsSlippage(basis_points=5.0, volume_limit=0.1)","text":"<p>\u70ba zipline \u9810\u8a2d\u6a21\u578b\uff0c\u8a2d\u5b9a\u56fa\u5b9a\u57fa\u9ede\u7684\u6ed1\u50f9\uff0c\u5176\u8a08\u7b97\u65b9\u6cd5\u70ba\uff08\u8cb7\u5165\u7684\u8a71\uff0c\u7b26\u865f\u70ba<code>+</code>\uff1b\u8ce3\u51fa\u7684\u8a71\uff0c\u7b26\u865f\u70ba<code>-</code>\uff09: $$ price \\times [(1 \\pm basis_points \\times 0.0001)] $$</p> <p>\u8a2d\u5b9a\u7576\u65e5\u4ea4\u6613\u91cf\u9650\u5236\uff1a $$ historical_volume \\times volume_limit, $$ $ historical_volume = $ \u7576\u65e5\u6210\u4ea4\u91cf\u3002</p>"},{"location":"#parameters_3","title":"Parameters:","text":"<ul> <li>basis_point (float, optional) - \u8a2d\u7f6e\u6ed1\u50f9\u57fa\u9ede\uff0c\u57fa\u9ede\u8d8a\u5927\uff0c\u6ed1\u50f9\u7a0b\u5ea6\u8d8a\u5927\uff0c\u9810\u8a2d = 5.0\u3002</li> <li>volume_limit (float, optional) - </li> <li>\u8cb7\u8ce3\u91cf\u4f54\u7e3d\u4ea4\u6613\u91cf\u7684\u6700\u9ad8\u767e\u5206\u6bd4\uff0c\u9810\u8a2d = 0.1\u3002</li> <li>\u6b64\u9650\u5236\u8003\u616e\u5982\u679c\u8cb7\u8ce3\u5927\u91cf\u80a1\u7968\uff0c\u6703\u5c0d\u80a1\u50f9\u9020\u6210\u904e\u5927\u5f71\u97ff\uff0c\u5c0e\u81f4\u504f\u96e2\u6b77\u53f2\u7684\u50f9\u683c\uff0c\u82e5\u5229\u7528\u7576\u5929\u6536\u76e4\u50f9\u9032\u884c\u6a21\u64ec\u4ea4\u6613\u5c31\u6703\u9ad8\u4f30\u7372\u5229\u3002</li> </ul>"},{"location":"#class-ziplinefinanceslippagenoslippage","title":"class zipline.finance.slippage.NoSlippage","text":"<p>\u4e0d\u8a2d\u7f6e\u6ed1\u50f9\u3002</p>"},{"location":"#notes_1","title":"Notes\uff1a","text":"<ul> <li>\u6ed1\u50f9\u8a08\u7b97\u6642\uff0c\u50f9\u683c\u4ee5\u6210\u4ea4\u65e5\u6536\u76e4\u50f9\u70ba\u6e96\uff0c\u6578\u91cf\u4e5f\u4ee5\u6210\u4ea4\u6642\u70ba\u6e96\u3002\u4e5f\u5c31\u662f\u8aaa\uff0c\u5982\u679c\u56e0\u70ba\u80a1\u6578\u8b8a\u52d5\u9020\u6210 amount \u6709\u4efb\u4f55\u8b8a\u5316\uff0c\u8a08\u7b97\u4e0a\u90fd\u662f\u7528\u6210\u4ea4\u6642\u65b0\u7684 amount\u3002</li> <li>\u5982\u679c <code>initialize(context)</code>: \u88e1\u9762\u6c92\u6709\u8a2d\u5b9a<code>set_slippage()</code>\uff0c\u7cfb\u7d71\u9810\u8a2d\u4f7f\u7528 <code>FixedBasisPointsSlippage(basis_points = 5.0, volume_limit = 0.1)</code>\u3002</li> <li>\u5982\u679c\u5e0c\u671b\u5b8c\u5168\u4e0d\u8003\u616e\u4ea4\u6613\u91cf\u53ca\u6ed1\u50f9\u9650\u5236\uff0c\u5247\u4f7f\u7528 <code>set_slippage(slippage.NoSlippage())</code>\u3002</li> </ul> <p>Go Top</p>"},{"location":"#examples-slippagemodel","title":"Examples\uff0dSlippageModel","text":"<p>\u4ee5\u4e0b\u7bc4\u4f8b\u6bd4\u8f03\u5404\u7a2e\u6a21\u578b\u8a08\u7b97\u65b9\u6cd5\u3002</p>"},{"location":"#import-settings","title":"Import settings","text":"<p><pre><code>import pandas as pd \nimport numpy as np\nimport tejapi\nimport os\n\n# tej_key\nos.environ['TEJAPI_BASE'] = 'https://api.tej.com.tw'\nos.environ['TEJAPI_KEY'] = 'your key'\n\n# set date\nos.environ['mdate'] = \"20221201 20221231\"\n\n# ticker\nos.environ['ticker'] = \"IR0001 1216 5844\"\n</code></pre> <pre><code># ingest\n!zipline ingest -b tquant\n</code></pre> <pre><code>from zipline.finance import commission, slippage\nfrom zipline.api import *\n\nfrom zipline import run_algorithm  \nfrom zipline.utils.run_algo import  get_transaction_detail\n</code></pre></p>"},{"location":"#fixedslippage","title":"FixedSlippage","text":"<p>Go Top</p> <p>\u8a2d\u7f6e\u4ea4\u6613\u7b56\u7565</p> <p>\u6210\u672c\u8a2d\u5b9a <pre><code>def initialize(context):\n  \n    ...\n    set_slippage(slippage.FixedSlippage(spread = 0.2))\n  \n    set_commission(commission.PerDollar(cost = commission_cost))\n    ...  \n</code></pre></p> <p>\u4e0b\u55ae\u8a2d\u5b9a - \u5728\u56de\u6e2c\u7684\u7b2c\u4e00\u500b\u4ea4\u6613\u6642\u9593\u9ede\uff08i \u7b49\u65bc 0\uff0c2022-12-01\uff09\u6642\uff1a <pre><code>def handle_data(context, data):\n   \n    if context.i == 0:  # 2022-12-01\n        for asset in context.asset:\n            order(asset, 5000)\n    ...\n</code></pre></p> <ul> <li>\u5728\u56de\u6e2c\u7684\u7b2c\u516b\u500b\u4ea4\u6613\u6642\u9593\u9ede\uff08i \u7b49\u65bc 7\uff0c2022-12-12\uff09\u6642 <pre><code>    ...\n    if context.i == 7:  # 2022-12-12\n        for asset in context.asset:\n            order(asset, -2000)   \n</code></pre></li> </ul> <p><pre><code>start_dt = pd.Timestamp('2022-12-01', tz='UTC')\nend_dt = pd.Timestamp('2022-12-31', tz='UTC')\n\ndef initialize(context):\n    context.i = 0\n    context.tickers = ['1216']\n    context.asset = [symbol(ticker) for ticker in context.tickers] \n\n    # \u8a2d\u5b9a\u6ed1\u50f9\u6a21\u578b\u4f86\u9032\u884c\u6a21\u64ec                \n    # set_slippage()\u53ea\u63a5\u6536\u4e00\u500bspread\u53c3\u6578\n    set_slippage(slippage.FixedSlippage(spread = 0.2))\n\n    # \u9019\u88e1\u5728\u63a5\u6536commission.PerDollar()\u56de\u50b3\u7d50\u679c\u5f8c\u8f38\u5165\u53c3\u6578\n    set_commission(commission.PerDollar(cost = commission_cost))\n\n    # \u8a2d\u5b9abenchmark\n    set_benchmark(symbol('IR0001'))\n\ndef handle_data(context, data):\n\n    if context.i == 0:  # 2022-12-01\n        for asset in context.asset:\n            order(asset, 5000)\n\n    if context.i == 7:  # 2022-12-12\n        for asset in context.asset:\n            order(asset, -2000)\n\n    context.i += 1\n\ncommission_cost = 0.001425 + 0.003 / 2\ncapital_base = 1e6\n</code></pre> <pre><code># \u8a55\u4f30\u7d50\u679c\nclosing_price = tejapi.fastget('TWN/APIPRCD',\n                               coid=['1216'],\n                               opts={'columns':['mdate','coid','close_d','vol']},\n                               mdate={'gte':start_dt,'lte':end_dt },\n                               paginate=True)\n\nclosing_price['vol'] = closing_price['vol'] * 1000\n\nperformance = run_algorithm(start=start_dt,\n                            end=end_dt,\n                            initialize=initialize,\n                            handle_data=handle_data,\n                            capital_base=capital_base,\n                            bundle='tquant')\n\npositions, transactions, orders = get_transaction_detail(performance)\n</code></pre> FixedSlippage - \u60c5\u6cc1 1: \u8cb7\u5165\u6642\u8a08\u7b97\u6ed1\u50f9</p> <ul> <li>12/1\u6642\u4e0b\u55ae\u8cb7 5 \u5f35\u7d71\u4e00\uff081216\uff09\u80a1\u7968\uff0c12/2\u6210\u4ea4\u3002</li> <li>\u6536\u76e4\u50f9\u662f 65.0\uff0c\u4f46\u56e0\u70ba\u6211\u5011\u8a2d\u5b9a spread = 0.2\uff0c\u6240\u4ee5\u6210\u4ea4\u50f9\uff08transactions.price\uff09\u662f 65 + 0.2 / 2 = 65.1\uff0c\u624b\u7e8c\u8cbb\uff08'commission'\uff09\u662f 65.1 * 5000 * 0.002925 = 952.0875\uff08\u624b\u7e8c\u8cbb\u662f\u9810\u5148\u8a2d\u5b9a\u597d\u7684\uff0c\u9019\u6b21\u7528 PerDollar\uff09\u3002</li> </ul> <p><pre><code>closing_price.query('(mdate == \"2022-12-02\")')\n</code></pre> </p> <p><pre><code>orders.query('(created.dt.strftime(\"%Y-%m-%d\") == \"2022-12-01\")')\n</code></pre> \u90e8\u5206\u8f38\u51fa\u7d50\u679c\u5982\u4e0b: </p> <p><pre><code>transactions.loc['2022-12-02']\n</code></pre> </p> <p>FixedSlippage - \u60c5\u6cc1 2: \u8ce3\u51fa\u6642\u8a08\u7b97\u6ed1\u50f9</p> <ul> <li>\u572812/12\u8ce3\u51fa 2 \u5f35\u7d71\u4e00\uff081216\uff09\u80a1\u7968\uff0c12/13\u6210\u4ea4\u3002</li> <li>12/13\u6536\u76e4\u50f9 65.4\uff0c\u7531\u65bc\u662f\u8ce3\u55ae\uff0c\u6240\u4ee5\u6210\u4ea4\u50f9\u662f 65.4 - 0.2 / 2 = 65.3\uff0c\u624b\u7e8c\u8cbb\u8a08\u7b97\u65b9\u6cd5\u4e00\u6a23\u3002 </li> </ul> <p><pre><code>closing_price.query('(mdate == \"2022-12-13\")')\n</code></pre> </p> <p><pre><code># \u572812/12\u8ce3\u51fa\u5169\u5f35\u7d71\u4e00 (1216) \u80a1\u7968\uff0c12/13\u6210\u4ea4\u3002\norders.query('(created.dt.strftime(\"%Y-%m-%d\") == \"2022-12-12\")')\n</code></pre> </p> <p><pre><code># \u6210\u4ea4\u50f9\u662f65.4 - 0.2 / 2 = 65.3\ntransactions.loc['2022-12-13']`\n</code></pre> </p>"},{"location":"#volumeshareslippage","title":"VolumeShareSlippage","text":"<p>Go Top</p> <p>\u8a2d\u7f6e\u4ea4\u6613\u7b56\u7565</p> <p>\u6ed1\u50f9\u8a2d\u5b9a <pre><code>def initialize(context):\n    ...\n    set_slippage(slippage.VolumeShareSlippage(volume_limit=0.025, price_impact=0.1))\n    ...\n</code></pre></p> <p>\u4e0b\u55ae\u8a2d\u5b9a - \u5728\u56de\u6e2c\u7684\u7b2c\u4e00\u500b\u4ea4\u6613\u6642\u9593\u9ede\uff08i \u7b49\u65bc 0\uff0c2022-12-01\uff09\u6642\uff1a <pre><code>def handle_data(context, data):\n    if context.i == 0: # 2022-12-01\n        for asset in context.asset:\n            order(asset, 1500000)  \n    ...\n</code></pre></p> <ul> <li>\u5728\u56de\u6e2c\u7684\u7b2c\u5341\u4e00\u500b\u4ea4\u6613\u6642\u9593\u9ede\uff08i \u7b49\u65bc 10\uff0c2022-12-15\uff09\u6642 <pre><code>    ...\n    if context.i == 10: # 2022-12-15\n        for asset in context.asset:\n            order(asset, -200000)    \n</code></pre></li> </ul> <p><pre><code>def initialize(context):\n    context.i = 0\n    context.tickers = ['1216']\n    context.asset = [symbol(ticker) for ticker in context.tickers]  \n\n#     set_slippage\n    set_slippage(slippage.VolumeShareSlippage(volume_limit=0.025, price_impact=0.1))\n\n    set_commission(commission.PerDollar(cost = commission_cost))\n    set_benchmark(symbol('IR0001'))\n\ndef handle_data(context, data):\n\n    if context.i == 0: # 2022-12-01\n        for asset in context.asset:\n            order(asset, 1500000)       \n\n    if context.i == 10: # 2022-12-15\n        for asset in context.asset:\n            order(asset, -200000)    \n\n    context.i += 1\n\ncapital_base = 1e8\n</code></pre> <pre><code>performance = run_algorithm(start=start_dt,\n                            end=end_dt,\n                            initialize=initialize,\n                            handle_data=handle_data,\n                            capital_base=capital_base,\n                            bundle='tquant')\n\npositions, transactions, orders = get_transaction_detail(performance)\n</code></pre> VolumeShareSlippage - \u60c5\u6cc1 1: \u8cb7\u5165\u6642\u8a08\u7b97\u6ed1\u50f9</p> <ul> <li>\u572812/1\u4e0b\u55ae 1500 \u5f35\u7d71\u4e00\uff0c\u4f46\u89c0\u5bdf\u6210\u4ea4\u91cf\u8cc7\u6599\u767c\u73fe\uff0c\u9019\u6bb5\u671f\u9593\u6bcf\u65e5\u6210\u4ea4\u91cf\u5927\u7d04\u53ea\u6709\u6578\u5343\u5230\u4e00\u842c\u591a\u5f35\uff08\u5f9e TEJ API\uff08TWN/APIPRCD\uff09\u53d6\u5f97\u7684\u6210\u4ea4\u91cf\uff08vol\uff09\u55ae\u4f4d\u662f\u5343\u80a1\uff0c\u4f46\u70ba\u4e86\u4e00\u81f4\u6027\uff0c\u6240\u4ee5\u6211\u5011\u9019\u908a\u5c07\u5343\u80a1\u8f49\u63db\u6210\u80a1\uff0c\u5229\u7528 order \u4e0b\u55ae\u6642\u7684\u55ae\u4f4d\u4e5f\u662f\u80a1\uff09\u3002</li> <li>\u56e0\u70ba\u6211\u5011\u8a2d\u5b9a volume_limit = 0.025\uff0c\u4f7f\u5f97 zipline \u6703\u628a\u9019\u7b46\u8a02\u55ae\u62c6\u6210\u6578\u5929\u6162\u6162\u6d88\u5316\uff0c\u6bcf\u5929\u6210\u4ea4\u91cf\u4e0d\u8d85\u904e\u8a72\u80a1\u7968\u7e3d\u6210\u4ea4\u91cf\u7684 2.5%\u3002</li> </ul> <p><pre><code># 1216\u6bcf\u65e5\u6210\u4ea4\u91cf\u5927\u7d04\u53ea\u6709\u6578\u5343\u5230\u4e00\u842c\u591a\u5f35\uff08vol\u55ae\u4f4d\u662f\u5343\u80a1\uff09\nclosing_price.query('(mdate &gt;= \"2022-12-01\")')\n</code></pre> \u90e8\u5206\u8f38\u51fa\u7d50\u679c\u5982\u4e0b: </p> <p><pre><code># \u572812/1\u4e0b\u55ae\u4e00\u5343\u4e94\u767e\u5f35\u7d71\u4e00\norders.loc['2022-12-01']\n</code></pre> \u90e8\u5206\u8f38\u51fa\u7d50\u679c\u5982\u4e0b: </p> <p>12/2\u7684\u7e3d\u6210\u4ea4\u91cf\u662f 15184000 \u80a1\uff0c\u7531\u65bc\u6211\u5011\u8a2d\u5b9a volume_limit = 0.025\uff0c\u56e0\u6b64 VolumeShareSlippage \u6703\u628a12/2\u7684\u6210\u4ea4\u91cf\u9650\u5236\u57282.5%\uff0c\u4e5f\u5c31\u662f379600\u80a1\u3002</p> <p>\u6210\u4ea4\u50f9\uff08transactions.price\uff09\u8a08\u7b97\u65b9\u6cd5\u662f\uff1a\u539f\u59cb\u6536\u76e4\u50f9 * ( 1 + price_impact * volume_share ^ 2 ) = 65 * ( 1 + 0.1 * 0.025 ^ 2 ) \\(\\approx\\) 65.004063 - price_impact \u662f\u9810\u5148\u8a2d\u5b9a\u597d\u76840.1\uff0c\u4e14\u56e0\u70ba\u6b64\u8655\u70ba\u8cb7\u55ae\uff0c\u6240\u4ee5\u7b26\u865f\u70ba\u6b63\u3002</p> <p><pre><code>orders.loc['2022-12-02']\n</code></pre> \u90e8\u5206\u8f38\u51fa\u7d50\u679c\u5982\u4e0b: </p> <p><pre><code>transactions.loc['2022-12-02']\n</code></pre>  orders \u8cc7\u6599\u4e2d\u7684 filled \u70ba\u7d2f\u7a4d\u6210\u4ea4\u91cf: - 12/7\u7684 filled = 1293325 \u80a1\uff0c\u4ee3\u8868 12/2 \u5230 12/7 \u6210\u4ea4\u7684\u7d2f\u8a08\u80a1\u6578 = 379600 + 242600 + 329275 + 341850 = 1293325\u3002 - \u622a\u81f312/8\u5df2\u7d93\u8cb7\u6eff\u4e86 1500 \u5f35\uff0c\u6240\u4ee5\u6700\u5f8c status \u5c31\u6703\u5f9e0 \u8b8a\u6210 1\uff0c\u4ee3\u8868\u7576\u521d\u4e0b\u7684 1500 \u5f35\u5df2\u7d93\u5168\u6578\u6210\u4ea4\u3002</p> <p><pre><code>orders.query('(created.dt.strftime(\"%Y-%m-%d\") == \"2022-12-01\")')\n</code></pre> \u90e8\u5206\u8f38\u51fa\u7d50\u679c\u5982\u4e0b: </p> <p>VolumeShareSlippage - \u60c5\u6cc1 2: \u8ce3\u51fa\u6642\u8a08\u7b97\u6ed1\u50f9</p> <ul> <li>\u5728 12/15 \u4e0b\u55ae\u8ce3\u51fa 200 \u5f35\u7d71\u4e00\uff0c\u56e0\u70ba\u572812/16\u7e3d\u4ea4\u6613\u91cf\u662f 10721 \u5f35\uff0cvolume_share = 200 / 10721 \\(\\approx\\) 0.018655\u5c0f\u65bc 0.025\uff0c\u6240\u4ee512/16\u4e00\u5929\u5c31\u80fd\u8ce3\u6389\u3002</li> <li>\u6210\u4ea4\u50f9\uff08transactions.price\uff09\u662f 65.3 * ( 1 - 0.1 * 0.018655 ^ 2 ) = 65.297728\uff08\u8ce3\u51fa\u7684\u8a71\u662f\u6e1b\uff09\u3002</li> </ul> <p><pre><code>closing_price.query('(mdate &gt;= \"2022-12-16\")')\n</code></pre> \u90e8\u5206\u8f38\u51fa\u7d50\u679c\u5982\u4e0b: </p> <p><pre><code>orders.query('(created.dt.strftime(\"%Y-%m-%d\") == \"2022-12-15\")')\n</code></pre> \u90e8\u5206\u8f38\u51fa\u7d50\u679c\u5982\u4e0b: </p> <p><pre><code>transactions.loc['2022-12-16']\n</code></pre> </p>"},{"location":"#fixedbasispointsslippage","title":"FixedBasisPointsSlippage","text":"<p>Go Top</p> <p>\u8a2d\u7f6e\u4ea4\u6613\u7b56\u7565</p> <p>\u6ed1\u50f9\u8a2d\u5b9a <pre><code>def initialize(context):\n    ...\n    set_slippage(slippage.FixedBasisPointsSlippage(basis_points=5.0, volume_limit=0.025))\n    ...\n</code></pre></p> <p>\u4e0b\u55ae\u8a2d\u5b9a - \u5728\u56de\u6e2c\u7684\u7b2c\u4e00\u500b\u4ea4\u6613\u6642\u9593\u9ede\uff08i \u7b49\u65bc 0\uff0c2022-12-01\uff09\u6642 <pre><code>def handle_data(context, data):\n    if context.i == 0: # 2022-12-01\n        for asset in context.asset:\n            order(asset, 1500000)   \n    ...\n</code></pre> - \u5728\u56de\u6e2c\u7684\u7b2c\u5341\u4e00\u500b\u4ea4\u6613\u6642\u9593\u9ede\uff08i \u7b49\u65bc 10\uff0c2022-12-15\uff09\u6642 <pre><code>    ...\n    if context.i == 10: # 2022-12-15\n        for asset in context.asset:\n            order(asset, -200000)    \n</code></pre></p> <p><pre><code>def initialize(context):\n    context.i = 0\n    context.tickers = ['1216']\n    context.asset = [symbol(ticker) for ticker in context.tickers]  \n\n#     set_slippage\n    set_slippage(slippage.FixedBasisPointsSlippage(basis_points=5.0, volume_limit=0.025))\n\n    set_commission(commission.PerDollar(cost = commission_cost))\n    set_benchmark(symbol('IR0001'))\n\ndef handle_data(context, data):\n\n    if context.i == 0: # 2022-12-01\n        for asset in context.asset:\n            order(asset, 1500000)       \n\n    if context.i == 10: # 2022-12-15\n        for asset in context.asset:\n            order(asset, -200000)    \n\n    context.i += 1\n\ncapital_base = 1e8\n</code></pre> <pre><code>performance = run_algorithm(start=start_dt,\n                            end=end_dt,\n                            initialize=initialize,\n                            handle_data=handle_data,\n                            capital_base=capital_base,\n                            bundle='tquant')\n\npositions, transactions, orders = get_transaction_detail(performance)\n</code></pre> FixedBasisPointsSlippage - \u60c5\u6cc1 1: \u8cb7\u5165\u6642\u8a08\u7b97\u6ed1\u50f9</p> <p>\u572812/1\u4e0b\u55ae 1500 \u5f35\u7d71\u4e00\uff0c\u6210\u4ea4\u91cf\u9650\u5236\u548c<code>VolumeShareSlippage</code>\u7bc4\u4f8b\u76f8\u540c\uff0c\u4e0d\u591a\u505a\u6558\u8ff0\u3002\u6240\u4ee512/1\u4e0b\u7684\u55ae\u5230\u4e8612/8\u624d\u5b8c\u5168\u6210\u4ea4\u3002</p> <p>\u4ee512/2\u70ba\u4f8b\uff0c\u6210\u4ea4\u50f9\uff08transactions.price\uff09\u8a08\u7b97\u65b9\u6cd5\u662f\uff1a\u539f\u59cb\u6536\u76e4\u50f9 * ( 1 + basis_point * 0.0001 ) = 65 * ( 1 + 5 * 0.0001 ) \\(\\approx\\) 65.0325 - basis_point \u662f\u9810\u5148\u8a2d\u5b9a\u597d\u7684 5\uff0c\u4e14\u56e0\u70ba\u6b64\u8655\u70ba\u8cb7\u55ae\uff0c\u6240\u4ee5\u7b26\u865f\u70ba\u6b63\u3002 <pre><code>closing_price.query('(mdate == \"2022-12-02\")')\n</code></pre> <pre><code>orders.query('(created.dt.strftime(\"%Y-%m-%d\") == \"2022-12-01\")')\n</code></pre> \u90e8\u5206\u8f38\u51fa\u7d50\u679c\u5982\u4e0b:  <pre><code>transactions.loc['2022-12-02']\n</code></pre> </p> <p>FixedBasisPointsSlippage - \u60c5\u6cc1 2: \u8ce3\u51fa\u6642\u8a08\u7b97\u6ed1\u50f9</p> <p>\u572812/15\u4e0b\u55ae\u8ce3\u51fa 200 \u5f35\u7d71\u4e00\u3002</p> <p>\u6210\u4ea4\u50f9\u8a08\u7b97\u65b9\u6cd5\u662f\uff1a\u539f\u59cb\u6536\u76e4\u50f9 * ( 1 - basis_point * 0.0001 ) = 65.3 * ( 1 - 5 * 0.0001 ) \\(\\approx\\) 65.26735 - basis_point \u662f\u9810\u5148\u8a2d\u5b9a\u597d\u7684 5\uff0c\u4e14\u56e0\u70ba\u6b64\u8655\u70ba\u8ce3\u55ae\uff0c\u6240\u4ee5\u7b26\u865f\u70ba\u8ca0\u3002</p> <p><pre><code>closing_price.query('(mdate == \"2022-12-16\")')\n</code></pre> </p> <p><pre><code>orders.query('(created.dt.strftime(\"%Y-%m-%d\") == \"2022-12-15\")')\n</code></pre> </p> <p><pre><code>transactions.loc['2022-12-16']\n</code></pre> </p> <p>Go Top</p>"}]}