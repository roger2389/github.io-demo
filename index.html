
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://roger2389.github.io/slippage/">
      
      
      
      
      <link rel="icon" href="images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Zipline Slippage</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#slippage-models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Zipline Slippage" class="md-header__button md-logo" aria-label="Zipline Slippage" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Zipline Slippage
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_3" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_3">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_4">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Zipline Slippage" class="md-nav__button md-logo" aria-label="Zipline Slippage" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Zipline Slippage
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Home
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ziplineapiset_slippageself-equitiesnone-futuresnone" class="md-nav__link">
    <span class="md-ellipsis">
      zipline.api.set_slippage(self, equities=None, futures=None)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="zipline.api.set_slippage(self, equities=None, futures=None)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      See also：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples：
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-ziplinefinanceslippageslippagemodel" class="md-nav__link">
    <span class="md-ellipsis">
      class zipline.finance.slippage.SlippageModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-ziplinefinanceslippagefixedslippagespread00" class="md-nav__link">
    <span class="md-ellipsis">
      class zipline.finance.slippage.FixedSlippage(spread=0.0)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="class zipline.finance.slippage.FixedSlippage(spread=0.0)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-ziplinefinanceslippagevolumeshareslippagevolume_limit0025-price_impact01" class="md-nav__link">
    <span class="md-ellipsis">
      class zipline.finance.slippage.VolumeShareSlippage(volume_limit=0.025, price_impact=0.1)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="class zipline.finance.slippage.VolumeShareSlippage(volume_limit=0.025, price_impact=0.1)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_2" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-ziplinefinanceslippagefixedbasispointsslippagebasis_points50-volume_limit01" class="md-nav__link">
    <span class="md-ellipsis">
      class zipline.finance.slippage.FixedBasisPointsSlippage(basis_points=5.0, volume_limit=0.1)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="class zipline.finance.slippage.FixedBasisPointsSlippage(basis_points=5.0, volume_limit=0.1)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_3" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-ziplinefinanceslippagenoslippage" class="md-nav__link">
    <span class="md-ellipsis">
      class zipline.finance.slippage.NoSlippage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="class zipline.finance.slippage.NoSlippage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notes_1" class="md-nav__link">
    <span class="md-ellipsis">
      Notes：
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples-slippagemodel" class="md-nav__link">
    <span class="md-ellipsis">
      Examples－SlippageModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples－SlippageModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Import settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixedslippage" class="md-nav__link">
    <span class="md-ellipsis">
      FixedSlippage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volumeshareslippage" class="md-nav__link">
    <span class="md-ellipsis">
      VolumeShareSlippage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixedbasispointsslippage" class="md-nav__link">
    <span class="md-ellipsis">
      FixedBasisPointsSlippage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><span id="top"></span></p>
<h1 id="slippage-models"><font color=#57a892>滑價模型（Slippage Models）</font></h1>
<ul>
<li>
<p>交易成本（transaction costs）被廣泛認為是影響投資績效的重要因素。它們不僅影響投資績效，還影響了將資產轉換成現金的難易度。</p>
</li>
<li>
<p>在真實世界的交易中存在許多種類的交易成本，其中一種是<strong>間接成本（indirect cost）</strong>，間接成本包含了<strong>滑價（slippage）</strong>、<strong>流動性（liquidity）</strong>等。因為股價隨時都在變動，下單時的些微時間差也可能造成<strong>預期的價格與成交價有落差</strong>，而這個價差就是<strong>滑價</strong>。<strong>流動性</strong>則會影響交易的難易度，我們通常可以用<strong>交易量</strong>來間接評估流動性。若股票平均來說交易量高，則通常代表該股票流動性高、可以迅速進行交易，同時滑價的影響也會降低。</p>
</li>
<li>
<p>若沒有考慮滑價及流動性可能會<strong>高估投資策略的獲利</strong>，特別是在投資組合中有<strong>成交量較低（流動性差）</strong>的股票、<strong>資金量（capital base）大</strong>或過度<strong>集中交易單一個股</strong>時，影響會更為明顯。這也是回測（backtesting）的一大目的，考量投資策略在真實世界運行的可能性。</p>
</li>
</ul>
<h2 id="ziplineapiset_slippageself-equitiesnone-futuresnone">zipline.api.<font color=#57a892>set_slippage</font>(self, equities=None, futures=None)</h2>
<p>設定回測時所使用的滑價模型。</p>
<blockquote>
<h3 id="parameters">Parameters：</h3>
<ul>
<li>equities <em>(EquitySlippageModel, optional)</em> －用於交易股票的滑價模型。</li>
<li>EquitySlippageModel：<code>zipline.finance.slippage</code></li>
<li>futures <em>(FutureSlippageModel, optional)</em> －用於交易期貨的滑價模型。（目前不支援）</li>
<li>FutureSlippageModel：<code>zipline.finance.slippage</code></li>
</ul>
<h3 id="raises">Raises：</h3>
<p><strong>SetSlippagePostInit</strong>－<code>set_slippage</code> <strong>只能</strong>在 <code>initialize</code> 階段使用。</p>
<h3 id="notes">Notes：</h3>
<ul>
<li><code>set_slippage</code> 只能一次用<strong>一種</strong>方法。</li>
</ul>
<h3 id="see-also">See also：</h3>
<ul>
<li><code>zipline.finance.slippage.FixedSlippage</code></li>
<li><code>zipline.finance.slippage.VolumeShareSlippage</code></li>
<li><code>zipline.finance.slippage.FixedBasisPointsSlippage</code></li>
</ul>
<h3 id="examples">Examples：</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">zipline.api</span> <span class="kn">import</span> <span class="n">set_slippage</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">zipline.finance</span> <span class="kn">import</span> <span class="n">slippage</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">set_slippage</span><span class="p">(</span><span class="n">slippage</span><span class="o">.&lt;</span><span class="n">其中一種</span> <span class="n">slippage</span> <span class="n">models</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div>
</blockquote>
<h2 id="class-ziplinefinanceslippageslippagemodel">class zipline.finance.slippage.<font color=#57a892>SlippageModel</font></h2>
<blockquote>
<p>滑價模型的抽象基類（Abstract Base Class）。</p>
<p>滑價模型可用來估計交易成交價與設定交易量限制。Zipline 目前有四種模型：
1. <code>FixedSlippage</code>：設定固定 spread 的滑價，<strong>不能</strong>設定成交量限制。
2. <code>VolumeShareSlippage</code>：根據該筆交易佔總交易量百分比來計算滑價，並可設定成交量限制。
3. <code>FixedBasisPointsSlippage</code>：設定固定基點的滑價，並可設定成交量限制。
4. <code>NoSlippage</code>：不設置滑價。</p>
</blockquote>
<h2 id="class-ziplinefinanceslippagefixedslippagespread00">class zipline.finance.slippage.<font color=#57a892>FixedSlippage</font>(spread=0.0)</h2>
<blockquote>
<ul>
<li>設定固定 spread 的滑價，<strong>不能</strong>設定成交量限制。</li>
<li>在每筆交易的成交價格額外加入 <span class="arithmatex">\(\pm \frac{spread}{2}\)</span>。</li>
<li>如果是買入，則成交價格 =  $ price + \frac{spread}{2}$ ；若是賣出，則成交價格 =   $ price - \frac{spread}{2}<span class="arithmatex">\(。\)</span> price = 當日收盤價$。</li>
</ul>
<h3 id="parameters_1">Parameters:</h3>
<ul>
<li>spread <em>(float, optional)</em> - 用來估計成交價與當日收盤價的價差。</li>
</ul>
</blockquote>
<h2 id="class-ziplinefinanceslippagevolumeshareslippagevolume_limit0025-price_impact01">class zipline.finance.slippage.<font color=#57a892>VolumeShareSlippage</font>(volume_limit=0.025, price_impact=0.1)</h2>
<blockquote>
<p>利用<strong>該筆交易佔當天總交易量的百分比</strong>（volume share）來計算滑價，考慮滑價後的成交價計算方法如下（買入的話，符號為<code>+</code>；賣出的話，符號為<code>-</code>）:</p>
<div class="arithmatex">\[ price \times [1 \pm ({price\_impact}) \times ({volume\_share}^2)], \]</div>
<p><em>$ price = $ 當日收盤價,</em>   <br />
<em>$ volume_share = $ 此單交易量佔總交易量百分比數，最高為 $ volume_limit $。</em></p>
<p>設定當日<strong>交易量限制</strong>：<br />
$$ historical_volume \times volume_limit, $$
<em>$ historical_volume = $ 當日成交量。</em></p>
<h3 id="parameters_2">Parameters:</h3>
<ul>
<li>volume_limit <em>(float, optional)</em> - </li>
<li>限制買賣量佔總交易量的最大百分比，預設 = 2.5 %。</li>
<li>此限制考慮如果買賣大量股票，會對股價造成過大影響，導致偏離歷史的價格，若利用當天收盤價進行模擬交易就會高估獲利。</li>
<li>price_impact <em>(float, optional)</em> - 滑價影響程度，其值越大時，滑價影響程度越大，預設 = 0.1。</li>
</ul>
</blockquote>
<h2 id="class-ziplinefinanceslippagefixedbasispointsslippagebasis_points50-volume_limit01">class zipline.finance.slippage.<font color=#57a892>FixedBasisPointsSlippage</font>(basis_points=5.0, volume_limit=0.1)</h2>
<blockquote>
<p><strong>為 zipline 預設模型</strong>，設定<strong>固定基點</strong>的滑價，其計算方法為（買入的話，符號為<code>+</code>；賣出的話，符號為<code>-</code>）:
$$ price \times [(1 \pm basis_points \times 0.0001)] $$</p>
<p>設定當日<strong>交易量限制</strong>：
$$ historical_volume \times volume_limit, $$
<em>$ historical_volume = $ 當日成交量。</em></p>
<h3 id="parameters_3">Parameters:</h3>
<ul>
<li>basis_point <em>(float, optional)</em> - 設置滑價基點，基點越大，滑價程度越大，預設 = 5.0。</li>
<li>volume_limit <em>(float, optional)</em> - </li>
<li>買賣量佔總交易量的最高百分比，預設 = 0.1。</li>
<li>此限制考慮如果買賣大量股票，會對股價造成過大影響，導致偏離歷史的價格，若利用當天收盤價進行模擬交易就會高估獲利。</li>
</ul>
</blockquote>
<h2 id="class-ziplinefinanceslippagenoslippage">class zipline.finance.slippage.<font color=#57a892>NoSlippage</font></h2>
<blockquote>
<p>不設置滑價。</p>
</blockquote>
<h3 id="notes_1">Notes：</h3>
<ul>
<li>滑價計算時，<strong>價格以成交日收盤價為準，數量也以成交時為準</strong>。也就是說，如果因為股數變動造成 amount 有任何變化，計算上都是用成交時新的 amount。</li>
<li>如果 <code>initialize(context)</code>: 裡面沒有設定<code>set_slippage()</code>，系統預設使用 <code>FixedBasisPointsSlippage(basis_points = 5.0, volume_limit = 0.1)</code>。</li>
<li>如果希望完全不考慮交易量及滑價限制，則使用 <code>set_slippage(slippage.NoSlippage())</code>。</li>
</ul>
<p><a href="#top">Go Top</a></p>
<h2 id="examples-slippagemodel">Examples－SlippageModel</h2>
<p>以下範例比較各種模型計算方法。</p>
<h4 id="import-settings">Import settings</h4>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import</span> <span class="nn">tejapi</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="c1"># tej_key</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TEJAPI_BASE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://api.tej.com.tw&#39;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TEJAPI_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;your key&#39;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="c1"># set date</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;mdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;20221201 20221231&quot;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="c1"># ticker</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IR0001 1216 5844&quot;</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># ingest</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="err">!</span><span class="n">zipline</span> <span class="n">ingest</span> <span class="o">-</span><span class="n">b</span> <span class="n">tquant</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">from</span> <span class="nn">zipline.finance</span> <span class="kn">import</span> <span class="n">commission</span><span class="p">,</span> <span class="n">slippage</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kn">from</span> <span class="nn">zipline.api</span> <span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="kn">from</span> <span class="nn">zipline</span> <span class="kn">import</span> <span class="n">run_algorithm</span>  
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="kn">from</span> <span class="nn">zipline.utils.run_algo</span> <span class="kn">import</span>  <span class="n">get_transaction_detail</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="fixedslippage"><strong><em>FixedSlippage</em></strong></h4>
<p><a href="#top">Go Top</a></p>
<p>設置交易策略</p>
<blockquote>
<p><strong>成本設定</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="o">...</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">set_slippage</span><span class="p">(</span><span class="n">slippage</span><span class="o">.</span><span class="n">FixedSlippage</span><span class="p">(</span><span class="n">spread</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">))</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>  
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="n">set_commission</span><span class="p">(</span><span class="n">commission</span><span class="o">.</span><span class="n">PerDollar</span><span class="p">(</span><span class="n">cost</span> <span class="o">=</span> <span class="n">commission_cost</span><span class="p">))</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="o">...</span>  
</code></pre></div></p>
<p><strong>下單設定</strong>
- 在回測的第一個交易時間點（i 等於 0，2022-12-01）時：
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>   
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># 2022-12-01</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="o">...</span>
</code></pre></div></p>
<ul>
<li>在回測的第八個交易時間點（i 等於 7，2022-12-12）時
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>    <span class="o">...</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># 2022-12-12</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">)</span>   
</code></pre></div></li>
</ul>
</blockquote>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">start_dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2022-12-01&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="n">end_dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2022-12-31&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>    <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>    <span class="n">context</span><span class="o">.</span><span class="n">tickers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1216&#39;</span><span class="p">]</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="n">context</span><span class="o">.</span><span class="n">asset</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbol</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">tickers</span><span class="p">]</span> 
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>    <span class="c1"># 設定滑價模型來進行模擬                </span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>    <span class="c1"># set_slippage()只接收一個spread參數</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>    <span class="n">set_slippage</span><span class="p">(</span><span class="n">slippage</span><span class="o">.</span><span class="n">FixedSlippage</span><span class="p">(</span><span class="n">spread</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">))</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>    <span class="c1"># 這裡在接收commission.PerDollar()回傳結果後輸入參數</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>    <span class="n">set_commission</span><span class="p">(</span><span class="n">commission</span><span class="o">.</span><span class="n">PerDollar</span><span class="p">(</span><span class="n">cost</span> <span class="o">=</span> <span class="n">commission_cost</span><span class="p">))</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>    <span class="c1"># 設定benchmark</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>    <span class="n">set_benchmark</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s1">&#39;IR0001&#39;</span><span class="p">))</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># 2022-12-01</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># 2022-12-12</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">)</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a>    <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="n">commission_cost</span> <span class="o">=</span> <span class="mf">0.001425</span> <span class="o">+</span> <span class="mf">0.003</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="n">capital_base</span> <span class="o">=</span> <span class="mf">1e6</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># 評估結果</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="n">closing_price</span> <span class="o">=</span> <span class="n">tejapi</span><span class="o">.</span><span class="n">fastget</span><span class="p">(</span><span class="s1">&#39;TWN/APIPRCD&#39;</span><span class="p">,</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>                               <span class="n">coid</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1216&#39;</span><span class="p">],</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>                               <span class="n">opts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;columns&#39;</span><span class="p">:[</span><span class="s1">&#39;mdate&#39;</span><span class="p">,</span><span class="s1">&#39;coid&#39;</span><span class="p">,</span><span class="s1">&#39;close_d&#39;</span><span class="p">,</span><span class="s1">&#39;vol&#39;</span><span class="p">]},</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>                               <span class="n">mdate</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gte&#39;</span><span class="p">:</span><span class="n">start_dt</span><span class="p">,</span><span class="s1">&#39;lte&#39;</span><span class="p">:</span><span class="n">end_dt</span> <span class="p">},</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>                               <span class="n">paginate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="n">closing_price</span><span class="p">[</span><span class="s1">&#39;vol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closing_price</span><span class="p">[</span><span class="s1">&#39;vol&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="n">performance</span> <span class="o">=</span> <span class="n">run_algorithm</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_dt</span><span class="p">,</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>                            <span class="n">end</span><span class="o">=</span><span class="n">end_dt</span><span class="p">,</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>                            <span class="n">initialize</span><span class="o">=</span><span class="n">initialize</span><span class="p">,</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>                            <span class="n">handle_data</span><span class="o">=</span><span class="n">handle_data</span><span class="p">,</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>                            <span class="n">capital_base</span><span class="o">=</span><span class="n">capital_base</span><span class="p">,</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>                            <span class="n">bundle</span><span class="o">=</span><span class="s1">&#39;tquant&#39;</span><span class="p">)</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="n">positions</span><span class="p">,</span> <span class="n">transactions</span><span class="p">,</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">get_transaction_detail</span><span class="p">(</span><span class="n">performance</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<strong><em>FixedSlippage - 情況 1: 買入時計算滑價</em></strong></p>
<ul>
<li>12/1時下單買 5 張統一（1216）股票，12/2成交。</li>
<li>收盤價是 65.0，但因為我們設定 spread = 0.2，所以成交價（transactions.price）是 65 + 0.2 / 2 = 65.1，手續費（'commission'）是 65.1 * 5000 * 0.002925 = 952.0875（手續費是預先設定好的，這次用 PerDollar）。</li>
</ul>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">closing_price</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(mdate == &quot;2022-12-02&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">orders</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(created.dt.strftime(&quot;%Y-%m-</span><span class="si">%d</span><span class="s1">&quot;) == &quot;2022-12-01&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
部分輸出結果如下:
<img alt="alt text" src="image-1.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022-12-02&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-2.png" /></p>
<p><strong><em>FixedSlippage - 情況 2: 賣出時計算滑價</em></strong></p>
<ul>
<li>在12/12賣出 2 張統一（1216）股票，12/13成交。</li>
<li>12/13收盤價 65.4，由於是賣單，所以成交價是 65.4 - 0.2 / 2 = 65.3，手續費計算方法一樣。 </li>
</ul>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">closing_price</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(mdate == &quot;2022-12-13&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-3.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># 在12/12賣出兩張統一 (1216) 股票，12/13成交。</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="n">orders</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(created.dt.strftime(&quot;%Y-%m-</span><span class="si">%d</span><span class="s1">&quot;) == &quot;2022-12-12&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-4.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># 成交價是65.4 - 0.2 / 2 = 65.3</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022-12-13&#39;</span><span class="p">]</span><span class="err">`</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-5.png" /></p>
<h4 id="volumeshareslippage"><strong><em>VolumeShareSlippage</em></strong></h4>
<p><a href="#top">Go Top</a></p>
<p>設置交易策略</p>
<blockquote>
<p><strong>滑價設定</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="o">...</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="n">set_slippage</span><span class="p">(</span><span class="n">slippage</span><span class="o">.</span><span class="n">VolumeShareSlippage</span><span class="p">(</span><span class="n">volume_limit</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">price_impact</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="o">...</span>
</code></pre></div></p>
<p><strong>下單設定</strong>
- 在回測的第一個交易時間點（i 等於 0，2022-12-01）時：
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># 2022-12-01</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="mi">1500000</span><span class="p">)</span>  
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="o">...</span>
</code></pre></div></p>
<ul>
<li>在回測的第十一個交易時間點（i 等於 10，2022-12-15）時
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>    <span class="o">...</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span> <span class="c1"># 2022-12-15</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="o">-</span><span class="mi">200000</span><span class="p">)</span>    
</code></pre></div></li>
</ul>
</blockquote>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>    <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>    <span class="n">context</span><span class="o">.</span><span class="n">tickers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1216&#39;</span><span class="p">]</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>    <span class="n">context</span><span class="o">.</span><span class="n">asset</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbol</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">tickers</span><span class="p">]</span>  
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="c1">#     set_slippage</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>    <span class="n">set_slippage</span><span class="p">(</span><span class="n">slippage</span><span class="o">.</span><span class="n">VolumeShareSlippage</span><span class="p">(</span><span class="n">volume_limit</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">price_impact</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>    <span class="n">set_commission</span><span class="p">(</span><span class="n">commission</span><span class="o">.</span><span class="n">PerDollar</span><span class="p">(</span><span class="n">cost</span> <span class="o">=</span> <span class="n">commission_cost</span><span class="p">))</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>    <span class="n">set_benchmark</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s1">&#39;IR0001&#39;</span><span class="p">))</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># 2022-12-01</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="mi">1500000</span><span class="p">)</span>       
<a id="__codelineno-18-17" name="__codelineno-18-17"></a>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span> <span class="c1"># 2022-12-15</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="o">-</span><span class="mi">200000</span><span class="p">)</span>    
<a id="__codelineno-18-21" name="__codelineno-18-21"></a>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a>    <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="n">capital_base</span> <span class="o">=</span> <span class="mf">1e8</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span>
<span class="normal"><a href="#__codelineno-19-6">6</a></span>
<span class="normal"><a href="#__codelineno-19-7">7</a></span>
<span class="normal"><a href="#__codelineno-19-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">performance</span> <span class="o">=</span> <span class="n">run_algorithm</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_dt</span><span class="p">,</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>                            <span class="n">end</span><span class="o">=</span><span class="n">end_dt</span><span class="p">,</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>                            <span class="n">initialize</span><span class="o">=</span><span class="n">initialize</span><span class="p">,</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>                            <span class="n">handle_data</span><span class="o">=</span><span class="n">handle_data</span><span class="p">,</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>                            <span class="n">capital_base</span><span class="o">=</span><span class="n">capital_base</span><span class="p">,</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>                            <span class="n">bundle</span><span class="o">=</span><span class="s1">&#39;tquant&#39;</span><span class="p">)</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="n">positions</span><span class="p">,</span> <span class="n">transactions</span><span class="p">,</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">get_transaction_detail</span><span class="p">(</span><span class="n">performance</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<strong><em>VolumeShareSlippage - 情況 1: 買入時計算滑價</em></strong></p>
<ul>
<li>在12/1下單 1500 張統一，但觀察成交量資料發現，這段期間每日成交量大約只有數千到一萬多張（從 TEJ API（TWN/APIPRCD）取得的成交量（vol）單位是千股，但為了一致性，所以我們這邊<strong>將千股轉換成股</strong>，<strong>利用 order 下單時的單位也是股</strong>）。</li>
<li>因為我們設定 volume_limit = 0.025，使得 zipline 會把這筆訂單拆成數天慢慢消化，每天成交量不超過該股票總成交量的 2.5%。</li>
</ul>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># 1216每日成交量大約只有數千到一萬多張（vol單位是千股）</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="n">closing_price</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(mdate &gt;= &quot;2022-12-01&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
部分輸出結果如下:
<img alt="alt text" src="image-6.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1"># 在12/1下單一千五百張統一</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="n">orders</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022-12-01&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
部分輸出結果如下:
<img alt="alt text" src="image-7.png" /></p>
<p>12/2的總成交量是 15184000 股，由於我們設定 volume_limit = 0.025，因此 VolumeShareSlippage 會把12/2的成交量限制在2.5%，也就是379600股。</p>
<p>成交價（transactions.price）計算方法是：原始收盤價 * ( 1 + price_impact * volume_share ^ 2 ) = 65 * ( 1 + 0.1 * 0.025 ^ 2 ) <span class="arithmatex">\(\approx\)</span> 65.004063
- price_impact 是預先設定好的0.1，且因為此處為買單，所以符號為正。</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">orders</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022-12-02&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
部分輸出結果如下:
<img alt="alt text" src="image-8.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022-12-02&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-9.png" />
orders 資料中的 filled 為累積成交量:
- 12/7的 filled = 1293325 股，代表 12/2 到 12/7 成交的累計股數 = 379600 + 242600 + 329275 + 341850 = 1293325。
- 截至12/8已經買滿了 1500 張，所以最後 status 就會從0 變成 1，代表當初下的 1500 張已經全數成交。</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">orders</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(created.dt.strftime(&quot;%Y-%m-</span><span class="si">%d</span><span class="s1">&quot;) == &quot;2022-12-01&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
部分輸出結果如下:
<img alt="alt text" src="image-10.png" /></p>
<p><strong><em>VolumeShareSlippage - 情況 2: 賣出時計算滑價</em></strong></p>
<ul>
<li>在 12/15 下單賣出 200 張統一，因為在12/16總交易量是 10721 張，volume_share = 200 / 10721 <span class="arithmatex">\(\approx\)</span> 0.018655小於 0.025，所以12/16一天就能賣掉。</li>
<li>成交價（transactions.price）是 65.3 * ( 1 - 0.1 * 0.018655 ^ 2 ) = 65.297728（賣出的話是減）。</li>
</ul>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">closing_price</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(mdate &gt;= &quot;2022-12-16&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
部分輸出結果如下:
<img alt="alt text" src="image-11.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="n">orders</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(created.dt.strftime(&quot;%Y-%m-</span><span class="si">%d</span><span class="s1">&quot;) == &quot;2022-12-15&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
部分輸出結果如下:
<img alt="alt text" src="image-12.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022-12-16&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-13.png" /></p>
<h4 id="fixedbasispointsslippage"><strong><em>FixedBasisPointsSlippage</em></strong></h4>
<p><a href="#top">Go Top</a></p>
<p>設置交易策略</p>
<blockquote>
<p><strong>滑價設定</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>    <span class="o">...</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>    <span class="n">set_slippage</span><span class="p">(</span><span class="n">slippage</span><span class="o">.</span><span class="n">FixedBasisPointsSlippage</span><span class="p">(</span><span class="n">basis_points</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">volume_limit</span><span class="o">=</span><span class="mf">0.025</span><span class="p">))</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    <span class="o">...</span>
</code></pre></div></p>
<p><strong>下單設定</strong>
- 在回測的第一個交易時間點（i 等於 0，2022-12-01）時
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># 2022-12-01</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="mi">1500000</span><span class="p">)</span>   
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>    <span class="o">...</span>
</code></pre></div>
- 在回測的第十一個交易時間點（i 等於 10，2022-12-15）時
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>    <span class="o">...</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span> <span class="c1"># 2022-12-15</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="o">-</span><span class="mi">200000</span><span class="p">)</span>    
</code></pre></div></p>
</blockquote>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>    <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>    <span class="n">context</span><span class="o">.</span><span class="n">tickers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1216&#39;</span><span class="p">]</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>    <span class="n">context</span><span class="o">.</span><span class="n">asset</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbol</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">tickers</span><span class="p">]</span>  
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="c1">#     set_slippage</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a>    <span class="n">set_slippage</span><span class="p">(</span><span class="n">slippage</span><span class="o">.</span><span class="n">FixedBasisPointsSlippage</span><span class="p">(</span><span class="n">basis_points</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">volume_limit</span><span class="o">=</span><span class="mf">0.025</span><span class="p">))</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a>    <span class="n">set_commission</span><span class="p">(</span><span class="n">commission</span><span class="o">.</span><span class="n">PerDollar</span><span class="p">(</span><span class="n">cost</span> <span class="o">=</span> <span class="n">commission_cost</span><span class="p">))</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a>    <span class="n">set_benchmark</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s1">&#39;IR0001&#39;</span><span class="p">))</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># 2022-12-01</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="mi">1500000</span><span class="p">)</span>       
<a id="__codelineno-31-17" name="__codelineno-31-17"></a>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a>    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span> <span class="c1"># 2022-12-15</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a>        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
<a id="__codelineno-31-20" name="__codelineno-31-20"></a>            <span class="n">order</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="o">-</span><span class="mi">200000</span><span class="p">)</span>    
<a id="__codelineno-31-21" name="__codelineno-31-21"></a>
<a id="__codelineno-31-22" name="__codelineno-31-22"></a>    <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-31-23" name="__codelineno-31-23"></a>
<a id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="n">capital_base</span> <span class="o">=</span> <span class="mf">1e8</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span>
<span class="normal"><a href="#__codelineno-32-6">6</a></span>
<span class="normal"><a href="#__codelineno-32-7">7</a></span>
<span class="normal"><a href="#__codelineno-32-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="n">performance</span> <span class="o">=</span> <span class="n">run_algorithm</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_dt</span><span class="p">,</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>                            <span class="n">end</span><span class="o">=</span><span class="n">end_dt</span><span class="p">,</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>                            <span class="n">initialize</span><span class="o">=</span><span class="n">initialize</span><span class="p">,</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>                            <span class="n">handle_data</span><span class="o">=</span><span class="n">handle_data</span><span class="p">,</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>                            <span class="n">capital_base</span><span class="o">=</span><span class="n">capital_base</span><span class="p">,</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>                            <span class="n">bundle</span><span class="o">=</span><span class="s1">&#39;tquant&#39;</span><span class="p">)</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="n">positions</span><span class="p">,</span> <span class="n">transactions</span><span class="p">,</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">get_transaction_detail</span><span class="p">(</span><span class="n">performance</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<strong><em>FixedBasisPointsSlippage - 情況 1: 買入時計算滑價</em></strong></p>
<p>在12/1下單 1500 張統一，成交量限制和<code>VolumeShareSlippage</code>範例相同，不多做敘述。所以12/1下的單到了12/8才完全成交。</p>
<p>以12/2為例，成交價（transactions.price）計算方法是：原始收盤價 * ( 1 + basis_point * 0.0001 ) = 65 * ( 1 + 5 * 0.0001 ) <span class="arithmatex">\(\approx\)</span> 65.0325
- basis_point 是預先設定好的 5，且因為此處為買單，所以符號為正。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="n">closing_price</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(mdate == &quot;2022-12-02&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-14.png" />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="n">orders</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(created.dt.strftime(&quot;%Y-%m-</span><span class="si">%d</span><span class="s1">&quot;) == &quot;2022-12-01&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
部分輸出結果如下:
<img alt="alt text" src="image-15.png" />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022-12-02&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-16.png" /></p>
<p><strong><em>FixedBasisPointsSlippage - 情況 2: 賣出時計算滑價</em></strong></p>
<p>在12/15下單賣出 200 張統一。</p>
<p>成交價計算方法是：原始收盤價 * ( 1 - basis_point * 0.0001 ) = 65.3 * ( 1 - 5 * 0.0001 ) <span class="arithmatex">\(\approx\)</span> 65.26735
- basis_point 是預先設定好的 5，且因為此處為賣單，所以符號為負。</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="n">closing_price</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(mdate == &quot;2022-12-16&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-17.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="n">orders</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(created.dt.strftime(&quot;%Y-%m-</span><span class="si">%d</span><span class="s1">&quot;) == &quot;2022-12-15&quot;)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-18.png" /></p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022-12-16&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<img alt="alt text" src="image-19.png" /></p>
<p><a href="#top">Go Top</a></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/sheng-hua-chen-8b735b2a5/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/your-twitter-handle" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            




  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" >
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.sections", "navigation.path", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "header.autohide", "announce.dismiss"], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>